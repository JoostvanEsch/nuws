
<!DOCTYPE html>
<html>
    <head>
        <script>
            
            function convertTagListToString(){
                var taglist = getTagsForAddingNewsitem();
                var tagstring = ""
                console.log("convertTagListToString");
                for (x in taglist){
                    console.log(x);
                } 
            }
            function newNieuwsItem(){
                //convertTagListToString()
                var newUrl= document.getElementById("nieuwsurlinput").value;
                var newTags = "test tag";
                var nieuwsitem = '{"url":"'+newUrl+'"}'; 
                //console.log(nieuwsitem);
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 202) {
                        document.getElementById("outputserver").innerHTML = this.responseText;
                    }
                };
                xhttp.open("POST", "http://localhost:8082/nuwspost", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(nieuwsitem);
            }
             
            function kopieerURL(value){
                console.log("kopieerURL werkt");
                document.getElementById("nieuwsurlinput").value = value;
            }
            
            function getNUNLlinks(){
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function(){
                    if (this.readyState == 4 && this.status == 200){
                        document.getElementById("artikellijst").innerHTML = "";
                        var data = JSON.parse(this.responseText);
                        for (i = 0; i < data.length; i++){
                            var lijst = data[i];
                            var indexA = lijst.indexOf("https");
                            var indexB = lijst.indexOf("\" target=");
                            var lijstUitgekleed = lijst.substring(indexA, indexB); 
                            var lijstfinal = lijst + " -> <button id='button' type='button' onclick='kopieerURL(\""+ lijstUitgekleed + "\")'>copy URL</button><br>";
                            document.getElementById("artikellijst").innerHTML += lijstfinal; 
                        }
                    } 
                };
                xhttp.open("GET", "http://localhost:8082/nunllinks", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();  
             } 
           
           
                function getTagsForAddingNewsitem(){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            var data = JSON.parse(this.responseText);
                            return data;
                         }
                    };
                xhttp.open("GET", "http://localhost:8082/nuwstags");
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }  
            
            function getTags(){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("taglist").innerHTML = "";
                            var data = JSON.parse(this.responseText);
                            for (i = 0; i < data.length; i++) {
                            	var j = parseInt(i);
                                var textaccumulation = "<label class=container><input id='"+data[j].id+"' type='checkbox'>"+data[j].tag+"<span class='checkmark'></span></label><br>"
                                document.getElementById("taglist").innerHTML += textaccumulation;
                            }
                                
                        }
                    };
                xhttp.open("GET", "http://localhost:8082/nuwstags");
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
            
            function deleteAll(){
               //console.log("ik doe het"); 
               var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                       console.log(this.responseText);
                    }
                };
                xhttp.open("GET", "http://localhost:8082/nuwsdelete", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
            
            function newTag(){
            	var newtag= document.getElementById("newTagInput").value;
                var tag = '{"tag":"'+newtag+'"}'; 
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log(this.responseText);
                        getTags();
                        document.getElementById("newTagInput").value = "";
                    }
                };
                xhttp.open("POST", "http://localhost:8082/newtag", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(tag);
                
                
            }
                
   
        </script>
        
        <style>
            iframe {
                position: default;
                border: none;
                height: 100%;
                width: 100%;
            }
            
            #linkfield{
                height: 30%;
                overflow-y: scroll;
            }
            #iframefield{
                height: 70%;
            }
            #linkerhelft{
                padding: 20;
            }
            
            #nieuwsurlinput{
                width: 300;
            }

        </style>
    </head>
    <body onload="getNUNLlinks(); getTags();">
        <div id='linkerhelft' style='float:left; width:50%; height:1000px'>
            <div id='linkfield'>
                <p id='artikellijst'></p> 
            </div>
            <div id='iframefield'>
                <iframe name='nunl_iframe'></iframe>
            </div>
        </div>
        
        <div style='float:right; width:50%; height:1000px'>
            <br>
            Add newsitem:<br>
            <input type="text" id="nieuwsurlinput" name="FirstName" value=""><br>
            
            <p id="taglist"></p>
            <button type="button" id="buttoninput" onclick="newNieuwsItem()">Add newsitem</button>
            
            <hr>
            Tags: <br>
            <input type="text" id="newTagInput" name="FirstName" value="">
            <button type="button" id="buttonNewTag" onclick="newTag()">Add new tag</button><br>
            <hr>
            Newsitems on site:<br>
            
            
            <button type="button" id="buttonDeleteAll" onclick="deleteAll()">Delete all newsitems</button>
            
        </div>
	</body>
</html>