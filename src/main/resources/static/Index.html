<!DOCTYPE html>
<html>
    <head>
	<script>			
            function startrefresh(){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("thumbpane").innerHTML = "";
                            var data = JSON.parse(this.responseText);
                            for (i = 0; i < data.length; i++) {
                            	   var j = parseInt(i);
                                var textaccumulation = "<a onclick='loadItem("+i+")'><div class=\"thumb\">" + data[j].title  + "</div></a>";
                                document.getElementById("thumbpane").innerHTML += textaccumulation;
                            }
                                
                        }
                    };
                xhttp.open("GET", "http://localhost:8082/nuwstitles");
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }	
            function loadItem(n){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("loadnews").innerHTML = "";
                            var nieuwsitem = JSON.parse(this.responseText);
                            
                                var textaccumulation = nieuwsitem.title  + "<br><br>" + nieuwsitem.sub + "<br><br>" + nieuwsitem.bodytext;
                                document.getElementById("loadnews").innerHTML += textaccumulation;
                            
                                
                        }
                    };
                 var numb = parseInt(n+1);
                xhttp.open("GET", "http://localhost:8082/nuws2/"+numb);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
            
            function register(){
            		var newUser= document.getElementById("username").value;
                var newPass= document.getElementById("password").value;
                var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}'; 
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        checkRegistration(this.responseText);
                    }
                };
                xhttp.open("POST", "http://localhost:8082/register", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(gebruiker);
            }
            
            function checkRegistration(a){
            		if (a == "true" ) {
            			var newUser= document.getElementById("username").value;
                    var newPass= document.getElementById("password").value;
                    var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}'; 
                    var xhttp = new XMLHttpRequest();
                    xhttp.open("POST", "http://localhost:8082/addRegistration", true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(gebruiker);
                    login(gebruiker);
            		} else {
            			alert("Deze gebruikersnaam is al geregistreerd. \nKies een andere gebruikersnaam.");
            		}
            }
            
            function login(gebruiker){
       	     	var newUser= document.getElementById("username").value;
       		     var newPass= document.getElementById("password").value;
       	    		 var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}';
    		   	     var xhttp = new XMLHttpRequest();
       		     xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                        checkLogin(this.responseText);
                    }
                };
                xhttp.open("POST", "http://localhost:8082/login", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(gebruiker);
        		
        		
        		
            }
            
            function checkLogin(messageFromEndpoint){
            if (messageFromEndpoint == "Login succes") {
        		var lpane = document.getElementById("loginPane");
        		var wpane = document.getElementById("welcomePane");
        		lpane.style.display = 'none';
        		wpane.style.display = 'block';
        		wpane.innerHTML = "Welkom " + document.getElementById("username").value + "<br>";
        		wpane.innerHTML += "<input type=\"submit\" value=\"Log-out\" onclick=\"logout()\"><hr>";
        		
                //xhttp.open("POST", "http://localhost:8082/checkLogin", true);
                //xhttp.setRequestHeader("Content-type", "application/json");
                //xhttp.send(gebruiker);
            } else if (messageFromEndpoint == "Password incorrect") {
            		alert("pass inc");
            } else if (messageFromEndpoint == "Username does not exist") {
            		alert("user no exist");
            }
        		
        		
        		
            }
            function logout(){
            	var lpane = document.getElementById("loginPane");
        		var wpane = document.getElementById("welcomePane");
        		lpane.style.display = 'block';
        		wpane.style.display = 'none';
            }
            
            
            
	</script>
	<style>
	.thumbpane {
		width:45%;
		float:left;
		background-color: #fff;
		padding-right:35px;
	}
	.textpane {
		width:45%;
		height:500px;
		float:right;
		margin-left:35px;
		background-color: #eee;
		overflow-y:scroll;
		margin-top:35px;
		padding-right:35px;
	}
	.thumb {
		width:120px;
		height:120px;
		margin-left:35px;
		margin-top:35px;
		padding:4px;
		background-color: #09f;
		color:#fff;
		align:center;
		float:right;
		z-index:2;
	}
	
	#loginPane{
	display:block;
	}
	#welcomePane{
	display:none;
	}
	
	
	</style>
    </head>
    <body onload="startrefresh()">
        

        <div id="loginPane">
  			Username: <input type="text" id="username">
  			Password: <input type="text" id="password">
 			<input type="submit" value="Log-in" onclick="login()">
 			<input type="submit" value="Register" onclick="register()">
 			<hr>	
        </div>
        <div id="welcomePane">

        </div>
        
        
                <button type="button" id="buttoninput" onclick="startrefresh()" >Refresh newsitems</button>
        <hr>	
        <div class="thumbpane" id="thumbpane"></div>
        <div class="textpane" id="loadnews"></div>

    </body>
</html>