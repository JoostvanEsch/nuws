<!DOCTYPE html>
<html>
    <head>
	<script>	
			
			var domain = "http://localhost:8082";
			var currentUser = {id:"100",naam:"test",password:"testww"}
			var currentNieuwsItem;
			
            function startrefresh(){
            	document.getElementById("thumbpane").innerHTML = "";
            	document.getElementById("loadnews").innerHTML = "";
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("thumbpane").innerHTML = "";
                            var data = JSON.parse(this.responseText);
                            for (i = 0; i < data.length; i++) {
                            	   var j = parseInt(data[i].id);
                            	   var color = getRandomColor();
                                var textaccumulation = "<a onclick='loadItem("+j+")'><div class=\"thumb\" style=\"background-color:"+color+";\">" + data[i].title  + "</div></a>";
                                document.getElementById("thumbpane").innerHTML += textaccumulation;
                            }
                                
                        }
                    };
                    console.log(domain);
                    console.log(domain + "/nuwstitles");
                xhttp.open("GET", (domain + "/nuwstitles"));
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }	
            
            function getRandomColor() {
            	  var letters = '0123456789ABCDEF';
            	  var color = '#';
            	  for (var i = 0; i < 6; i++) {
            	    color += letters[Math.floor(Math.random() * 16)];
            	  }
            	  return color;
            	}
            
            function loadItem(id){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("loadnews").innerHTML = "";
                            var nieuwsitem = JSON.parse(this.responseText);
                            currentNieuwsItem = this.responseText;
                            console.log(currentNieuwsItem);
                                var textaccumulation = "<h1>" + nieuwsitem.title + "</h1>"  + "<br><br>" + nieuwsitem.sub + "<br><br>" + nieuwsitem.bodytext;
                                document.getElementById("loadnews").innerHTML += textaccumulation;
                            
                                
                        }
                    };
                xhttp.open("GET", domain + "/nuws2/"+id);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
            
            function register(){
            		var newUser= document.getElementById("username").value;
                var newPass= document.getElementById("password").value;
                var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}'; 
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        checkRegistration(this.responseText);
                    }
                };
                xhttp.open("POST", domain + "/register", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(gebruiker);
            }
            
            function checkRegistration(a){
            		if (a == "true" ) {
            			var newUser= document.getElementById("username").value;
                    var newPass= document.getElementById("password").value;
                    var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}'; 
                    var xhttp = new XMLHttpRequest();
                    xhttp.open("POST", domain + "/addRegistration", true);
                    xhttp.setRequestHeader("Content-type", "application/json");
                    xhttp.send(gebruiker);
                    login(gebruiker);
            		} else {
            			alert("Deze gebruikersnaam is al geregistreerd. \nKies een andere gebruikersnaam.");
            		}
            }
            
            function login(gebruiker){
       	     	var newUser= document.getElementById("username").value;
       		     var newPass= document.getElementById("password").value;
       	    		 var gebruiker = '{"naam":"'+newUser+'" ,"password":"'+newPass+'"}';
    		   	     var xhttp = new XMLHttpRequest();
       		     xhttp.onreadystatechange = function() {
               if (this.readyState == 4 && this.status == 200) {
                        checkLogin(this.responseText);
                    }
                };
                xhttp.open("POST", domain + "/login", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(gebruiker);
            }
            
            function checkLogin(messageFromEndpoint){
            	if (messageFromEndpoint == "Password incorrect") {
            		alert("pass inc");
            	} else if (messageFromEndpoint == "Username does not exist") {
            		alert("user no exist");
            } else {
            	setCurrentUser(messageFromEndpoint);
        		var lpane = document.getElementById("loginPane");
        		var wpane = document.getElementById("welcomePane");
        		var rpane = document.getElementById("reviewpane");
        		lpane.style.display = 'none';
        		wpane.style.display = 'block';
        		rpane.style.display = 'block';
        		wpane.innerHTML = "<input type=\"submit\" value=\"Log-out\" onclick=\"logout()\">";
        		wpane.innerHTML += "Welkom TestUser <br><hr>";
            }
            }
            
        		
            function setCurrentUser(id){
                var xhttp = new XMLHttpRequest();
                    xhttp.onreadystatechange = function() {
                        if (this.readyState == 4 && this.status == 200) {
                            currentUser = this.responseText;
                            console.log("Current User = " + currentUser);
                        }
                    };
                xhttp.open("GET", domain + "/gebruiker/"+id);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send();
            }
        		
            
            function logout(){
            	var lpane = document.getElementById("loginPane");
        		var wpane = document.getElementById("welcomePane");
        		var rpane = document.getElementById("reviewpane");
        		lpane.style.display = 'block';
        		wpane.style.display = 'none';
        		rpane.style.display = 'none';
        		currentUser = "";
            }
            
            function addReview(){
        		var newReviewContent = document.getElementById("reviewcontent").value;
            var review = '{"tekst":"'+newReviewContent+'","nieuwsitem":'+currentNieuwsItem+',"gebruiker":'+currentUser+'}';
            console.log("DIT IS EEN TEST\n"+review);
                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        //checkRegistration(this.responseText);
                    }
                };
                xhttp.open("POST", domain + "/addReview", true);
                xhttp.setRequestHeader("Content-type", "application/json");
                xhttp.send(review);
            }
            
            
            
	</script>
	<style>
	.thumbpane {
		width:45%;
		float:left;
		background-color: #fff;
		padding-right:35px;
	}
	.textpane {
		width:45%;
		height:500px;
		background-color: #eee;
		overflow-y:scroll;
		margin-top:35px;
		margin-right:35px;
		padding-left:35px;
		padding-right:35px;
	}
	.thumb {
		width:120px;
		height:120px;
		margin-left:35px;
		margin-top:35px;
		padding:7px;
		background-color: #09f;
		color:#fff;
		align:center;
		float:right;
		z-index:2;
		overflow:hidden;
	}
	
	#loginPane{
	display:block;
	}
	#welcomePane{
	display:none;
	}
	#reviewpane{
	display:none;
	padding-top:35px;
	}

	
	
	
	</style>
    </head>
    <body onload="startrefresh()">
        

        <div id="loginPane">
  			Username: <input type="text" id="username">
  			Password: <input type="text" id="password">
 			<input type="submit" value="Log-in" onclick="login()">
 			<input type="submit" value="Register" onclick="register()">
 			<hr>	
        </div>
        <div id="welcomePane">

        </div>
        
        
                <button type="button" id="buttoninput" onclick="startrefresh()" >Refresh newsitems</button>
        <hr>	
        <div class="thumbpane" id="thumbpane">Thumbs</div>
        <div class="textpane" >
        <div id="reviewpane">
        <textarea id="reviewcontent" style="width:80%" rows="5" name="reviewcontent" form="reviewform">Enter comment...</textarea><br>
        <form id="reviewform">
        <input type="button" value="Submit" onclick="addReview()">
        </form>
        </div>
        <div id="loadnews">
        
        </div>
        </div>

    </body>
</html>












